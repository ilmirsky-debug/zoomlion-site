import fs from "fs";
import path from "path";

export default function handler(req, res) {
  try {
    // –ø—É—Ç—å –¥–æ stock.json
    const filePath = path.join(process.cwd(), "public", "stock", "stock.json");
console.log("üìÅ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –≤:", filePath);


    if (req.method === "POST") {
      fs.writeFileSync(filePath, JSON.stringify(req.body, null, 2), "utf-8");
      console.log("‚úÖ Stock.json —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!");
      return res.status(200).json({ message: "Stock updated successfully" });
    }

    if (req.method === "GET") {
      const data = fs.readFileSync(filePath, "utf-8");
      return res.status(200).json(JSON.parse(data));
    }

    res.setHeader("Allow", ["GET", "POST"]);
    return res.status(405).json({ message: `Method ${req.method} not allowed` });

  } catch (err) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å stock.json:", err);
    return res.status(500).json({ message: "Internal Server Error", error: err.message });
  }
}
